<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8" />
    <title>Gamedev Canvas Workshop</title>
    <style>
        * {
            padding: 0;
            margin: 0;
        }

        canvas {
            background: #eee;
            display: block;
            margin: 0 auto;
        }
    </style>
</head>

<body>

    <button onclick="startInterval()">2초마다 현재 시간을 표시</button>
    <button onclick="cancelInterval()">시간 갱신 중지</button>

    <input type="\">
    <button onclick="PaddleSpeedUp(1)">Paddle Speed +</button>
    <button onclick="PaddleSpeedDown(1)">Paddle Speed -</button>

    <p id="date"></p>
    <script>
        function startInterval() {
            timeoutId = setInterval(printCurrentDate, 2000);
        }
        function cancelInterval() {
            clearInterval(timeoutId);
        }
        function printCurrentDate() {
            document.getElementById("date").innerHTML = new Date() + "<br>";
        }
    </script>


    <canvas id="myCanvas" width="480" height="320"></canvas>
    <script>
        var canvas = document.getElementById("myCanvas");
        var ctx = canvas.getContext("2d");
        
        var x = canvas.width/2;
        var y = canvas.height - 30;

        var dx = 2;
        var dy = 2;

        // Paddle Setting
        var paddleHeight = 10;
        var paddleWidth = 75;
        var paddleX = (canvas.width - paddleWidth) / 2;
        var paddleSpeed = 7;

        // Keyboard boolean
        var rightPressed = false;
        var leftPressed = false;        

        var ballRadius = 10;

        // Key Click Event
        document.addEventListener("keydown", KeyDownHandler, false);
        document.addEventListener("keyup", KeyUpHandler, false);
        
        function KeyDownHandler(e) {
            if(e.keyCode == 39) { // right
                rightPressed = true;
                console.log("rightPress 1");
            } 
            else if(e.keyCode == 37) { // left
                leftPressed = true;
            } 
        }

        function KeyUpHandler(e) {
            if(e.keyCode == 37) { // right
                leftPressed = false;
            }
            else if(e.keyCode == 39) { // left
                rightPressed =false;
            }
            
        }


        function WallCollisionCheck() {
            let isHit = false;
            // max X
            if (x + ballRadius / 2 >= canvas.width ||
                x - ballRadius / 2 <= 0) {
                dx *= -1;
                isHit = true;
            }
            else if (y + ballRadius / 2 >= canvas.height ||
                y - ballRadius / 2 <= 0) {
                dy *= -1;
                isHit = true;
            }
            return isHit;
        }

        ////////////////// Update ////////////////// ↓
        function Draw() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);

            x += dx;
            y -= dy;
            let isHit = WallCollisionCheck();

            if (isHit == true) {
                ColorChange();
            }
            
            // Move paddle
            if(rightPressed && paddleX + paddleWidth < canvas.width) {
                paddleX += paddleSpeed;
            }
            else if(leftPressed && paddleX > 0){
                paddleX -= paddleSpeed;
            }

            DrawRect(canvas.width / 2 - 50 / 2, canvas.height / 2 - 50 / 2, 50, 50);
            DrawRect(x - 50 / 2, y - 50 / 2, 50, 50);
            DrawPaddle();

            DrawCircle(x, y, ballRadius, 0);
        }
        ////////////////// Update End  //////////////////

        function ColorChange() {
            let colorR = Math.round(Math.random() * 100);
            let colorG = Math.round(Math.random() * 100);
            let colorB = Math.round(Math.random() * 100);
            let colorStr = "rgba(" + colorR + "," + colorG + "," + colorB + ")";
            ctx.strokeStyle = colorStr;
        }


        // Functions

        function PaddleSpeedUp(_speed) {
            if(paddleSpeed > 10) {
                return;
            }
            paddleSpeed += _speed;

        }
        function PaddleSpeedDown(_speed) {
            if(paddleSpeed <= 0) {
                return;
            }
            paddleSpeed -= _speed;
        }



        function DrawRect(x, y, w, h) {
            ctx.beginPath();
            ctx.rect(x, y, w, h);
            ctx.fillStyle = "#FF0000";
            ctx.fill();
            ctx.closePath();
        }

        function DrawCircle(x, y, radius) {
            ctx.beginPath();
            ctx.arc(x, y, radius, 0, Math.PI * 2, true);
            ctx.fillStyle = "green";
            ctx.fill();
            ctx.closePath();
        }

        function DrawPaddle() {
            ctx.beginPath();
            ctx.rect(paddleX, canvas.height-paddleHeight, paddleWidth, paddleHeight);
            ctx.fillStyle = "#0095DD";
            ctx.fill();
            ctx.closePath();
        }

        // Object Structure
        var Object = {
            name: "newName",
            position: { x: 0, y: 0, z: 0 }
        }

        var Vector2 = {
            x: 0,
            y: 0
        }

        setInterval(Draw, 10);
    </script>

</body>

</html>